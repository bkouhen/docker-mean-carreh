version: "3.4"

services:
    syslog:
        image: mysyslog
        build:
            context: ./syslog
            dockerfile: Dockerfile
        container_name: sys
        hostname: syslog
        restart: always
        volumes: 
            - "./log:/var/log/dockerlogs"
        ports:
            - 514:514
            - 514:514/udp
        cap_add: 
            - SYSLOG

    nginx:
        image: nginx
        container_name: ng
        ports:
            - 80:80
        depends_on: 
            - syslog
        logging: 
            driver: syslog
            options:
                syslog-address: "tcp://0.0.0.0:514"
                tag: docker-{{.Name}}

    nginx2:
        image: nginx
        container_name: ng2
        ports:
            - 8080:80
        depends_on: 
            - syslog
        logging: 
            driver: syslog
            options: 
                syslog-address: "tcp://0.0.0.0:514"
                tag: docker-{{.Name}}

    portainer:
        image: portainer/portainer
        container_name: pt
        command: -H unix:///var/run/docker.sock
        restart: always
        ports:
            - 9000:9000
            - 8000:8000
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - portainer_data:/data
        
volumes:
    portainer_data: